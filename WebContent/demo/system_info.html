<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>系统参数管理</title>
		<link rel="stylesheet" href="../frame/layui/css/layui.css">
		<!--<link rel="stylesheet" href="http://cdn.datatables.net/1.10.13/css/jquery.dataTables.min.css">-->
		<link rel="stylesheet" href="../frame/static/css/style.css">
		<link rel="icon" href="../frame/static/image/code.png">
		<script src="../js/jquery.min.js"></script>
	</head>

	<body class="body">

		<!-- 工具集 -->
		<div class="my-btn-box">
			<span class="fl">
        <a class="layui-btn layui-btn-danger radius btn-delect" id="btn-delete-all">批量删除</a>
        <a class="layui-btn btn-add btn-default" id="systemAdd">添加</a>
        <a class="layui-btn btn-add btn-default" id="btn-refresh"><i class="layui-icon">&#x1002;</i></a>
    </span>
			<span class="fr">
        <span class="layui-form-label">搜索条件：</span>
			<div class="layui-input-inline">
				<input type="text" autocomplete="off" placeholder="请输入搜索条件" class="layui-input">
			</div>
			<button class="layui-btn mgl-20">查询</button>
			</span>
		</div>

		<!-- 表格 -->
		<div id="dateTable" lay-filter="dateTable"></div>
		<!-- 需要弹出的修改和添加员工界面 -->
		<div class="layui-row" id="updateSystem" style="display:none;">
		    <div class="layui-col-md10" style="margin-left: 10px;margin-top: 10px;">
		        <form class="layui- layui-form-pane" lay-filter="systemFormFilter">
		            <div class="layui-form-item">
		                <label class="layui-form-label" style="width: 130px">系统英文名称：</label>
		                <div class="layui-input-inline">
		                    <input type="text" id="systemEnname" name="systemEnname"  class="layui-input">
		                </div>
		            </div>
		            <div class="layui-form-item">
		                 <label class="layui-form-label" style="width: 130px">系统中文名称：</label>
		                <div class="layui-input-inline">
		                	<input type="text" id="systemCnname" name="systemCnname" class="layui-input">
		                </div>
		            </div>
		            <div class="layui-form-item">
		                <label class="layui-form-label" style="width: 130px">备用字段1：</label>
		                <div class="layui-input-inline">
		                    <input type="text" id="absOne" name="absOne" class="layui-input">
		                </div>
		            </div>
		            <div class="layui-form-item">
		                <label class="layui-form-label" style="width: 130px">备用字段2：</label>
		                <div class="layui-input-inline">
		                    <input type="text" id="absTwo" name="absTwo" class="layui-input">
		                </div>
		            </div>
		            <div class="layui-form-item">
		                <label class="layui-form-label" style="width: 130px">备注：</label>
		                <div class="layui-input-block" style="margin: auto;">
		                    <textarea id="remake" class="layui-textarea" name="remake"></textarea>
		                </div>
		            </div>
		            <div class="layui-form-item">
		                <div class="layui-input-block">
		                    <button type="button" id="addSystem" class="layui-btn layui-btn-normal">提交</button>
		                    </script>
		                </div>
		            </div>
		        </form>
		    </div>
		</div>
		<script type="text/javascript" src="../frame/layui/layui.js"></script>
		<script type="text/javascript" src="../js/index.js"></script>
		<script type="text/html" id="barOption">
			<a class="layui-btn layui-btn-mini layui-btn-normal"  lay-event="edit">编辑</a>
			<a class="layui-btn layui-btn-mini layui-btn-danger"  lay-event="del">删除</a>
		</script>
		<script type="text/javascript">
			
			var popForm;
			// layui方法
			layui.use(['table', 'form', 'layer', 'vip_table'], function() {

				// 操作对象
				var form = layui.form,
					table = layui.table,
					layer = layui.layer,
					vipTable = layui.vip_table,
					$ = layui.jquery;
					popForm= layui.form;
				// 表格渲染
				var tableIns = table.render({
					elem: '#dateTable' ,//指定原始表格元素选择器（推荐id选择器）
					height: vipTable.getFullHeight() ,//容器高度
					cols: [
						[ //标题栏
							{checkbox: true,sort: true,fixed: true,space: true}, 
							{field: 'systemEnname',title: '系统英文名称',width: 150}, 
							{field: 'systemCnname',title: '系统中文名称',width: 200}, 
							{field: 'remake',title: '备注',width: 200}, 
							{field: 'absOne',title: '备用字段1',width: 150}, 
							{field: 'absTwo',title: '备用字段2',width: 150}, 
							{fixed: 'right',title: '操作',width: 150,align: 'center',toolbar: '#barOption'} //这里的toolbar值是模板元素的选择器
						]
					],
					id: 'dataCheck',
					url: '/ParamManage/system/systemInfo',
					method: 'get',
					page: true,
					limits: [2, 3, 4, 5],
					limit: 2 , //默认采用10        				
					loading: false,
					success: function(res, curr, count) {
						//如果是异步请求数据方式，res即为你接口返回的信息。
						//如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
						console.log(res);

						//得到当前页码
						console.log(curr);

						//得到数据总量
						console.log(count);
					},
					error: function() {
						alert("失败！");
					}
				});

				// 获取选中行
				table.on('checkbox(dataCheck)', function(obj) {
					layer.msg('123');
					console.log(obj.checked); //当前是否选中状态
					console.log(obj.data); //选中行的相关数据
					console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
				});

				// 刷新
				$('#btn-refresh').on('click', function() {
					tableIns.reload();
				});
				
				$("#systemAdd").click(function() {
					layer.open({
						type: 1,
						title:'新增系统',
						skin: 'layui-layer-lan', //加上边框
						area: ['500px', '500px'], //宽高
						content:$("#updateSystem").html()
					});
				});
			
//				$('#addSystem').on('click',function(){
//						alert("dasda");
//						var systemEnname=$('#systemEnname').val();
//						var systemCnname=$('#systemCnname').val();
//						var remake=$('#remake').val();
//						var absOne=$('#absOne').val();
//						var absTwo=$('#absTwo').val();
//						$.ajax({
//							type: "post",
//							url: "/ParamManage/user/addSystem",
//							async: false,
//							dataType:"json",
//							scriptCharset: 'utf-8',
//							data:{
//								"systemEnname":systemEnname,
//								"systemCnname":systemCnname,
//								"remake":remake,
//								"absOne":absOne,
//								"absTwo":absTwo
//							},
//							success: function(date) {
//								layer.msg(date.msg);
//								tableIns.reload();
//							},
//							error: function(date) {
//								layer.msg(date.msg);
//								tableIns.reload();
//							}
//						});
//					});
				//监听行工具事件
			  	table.on('tool(dateTable)', function(obj){
				    var data = obj.data;
				    console.log(data)
				    if(obj.event === 'del'){
					    layer.confirm('真的删除行么', function(index){
					      	$.ajax({
					      		type:"post",
					      		url:"/ParamManage/system/deleteSystem",
					      		async:true,
					      		dataType:"json",
					      		data:{
					      			"systemEnname":data.systemEnname
					      		},
					      		success:function(date){
					      			layer.close(index);
					      			layer.msg(date.msg);
					      			tableIns.reload();
					      		},
					      		error:function(date){
					      			layer.close(index);
					      			layer.msg(date.msg);
					      			tableIns.reload();
					      		}
					      	});			        
					    });
				    } else if(obj.event === 'edit'){
				      	layer.open({
				            type:1,
				            title:"修改系统信息",
				            skin: 'layui-layer-lan',
				            area: ['500px', '500px'],
				            content:$("#updateSystem").html()
		       			 });
		       			 setFormValue(data);//动态向表单赋值
				    }
	  			});
	  			
	  			function setFormValue(data){
					popForm.val("systemFormFilter", {
						"systemEnname":systemEnname,
						"systemCnname":systemCnname,
						"remake":remake,
						"absOne":absOne,
						"absTwo":absTwo
						});
			  		popForm.render(null,'systemFormFilter')
			  	}
			});
		</script>
		<!-- 表格操作按钮集 -->
		
	</body>

</html>